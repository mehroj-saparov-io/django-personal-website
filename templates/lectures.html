{% extends "base.html" %}
{% block title %}Lectures – Mehroj Saparov{% endblock %}

{% block content %}

<section class="space-y-10">
    <header class="space-y-4">
        <h1 class="font-display text-4xl">Lectures</h1>

        <div class="flex flex-wrap items-center gap-4 text-sm text-[var(--text-muted)]">

            <a href="{% url 'lectures' %}"
               class="{% if not current_category %}text-[var(--accent)] font-medium{% endif %}">
                {{ total_count }} Lectures
            </a>

            {% for name, count in top_categories %}
                <a href="?category={{ name }}"
                   class="{% if current_category == name %}text-[var(--accent)] font-medium{% endif %}">
                    {{ count }} {{ name }}
                </a>
            {% endfor %}

            {% if other_categories %}
            <button
                onclick="toggleOthers()"
                class="hover:text-[var(--accent)] transition">
                Others
            </button>
            {% endif %}
        </div>

        {% if other_categories %}
        <div id="otherCategories"
             class="hidden mt-4 p-4 border rounded-xl
                    bg-[var(--bg-soft)]
                    grid grid-cols-2 sm:grid-cols-3 gap-3">
            {% for name, count in other_categories %}
                <a href="?category={{ name }}"
                   class="px-4 py-2 text-sm rounded-lg text-center
                          border hover:border-[var(--accent)]
                          {% if current_category == name %}
                          border-[var(--accent)] text-[var(--accent)]
                          {% endif %}
                          transition">
                    {{ name }}
                    <span class="text-xs text-[var(--text-muted)]">({{ count }})</span>
                </a>
            {% endfor %}
        </div>
        {% endif %}
    </header>

    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">

        {% for lecture in page_obj %}
        <div class="border rounded-xl overflow-hidden"
             style="border-color: var(--border); background-color: var(--bg-soft);">

            <button
                onclick="openVideo('{{ lecture.youtube_id }}')"
                class="relative w-full group">

                <img
                    src="https://img.youtube.com/vi/{{ lecture.youtube_id }}/hqdefault.jpg"
                    alt="{{ lecture.title }}"
                    class="w-full aspect-video object-cover"
                >

                <div class="absolute inset-0 flex items-center justify-center bg-black/40
                            opacity-0 group-hover:opacity-100 transition">
                    <span class="text-white text-5xl">▶</span>
                </div>
            </button>

            <div class="p-4 space-y-2">
                <h3 class="font-medium">
                    {{ lecture.id }}. {{ lecture.title }}
                </h3>

                <!-- CATEGORY BADGES -->
                <div class="flex flex-wrap gap-2">
                    {% for cat in lecture.category %}
                        <span class="px-2 py-1 text-xs rounded-md"
                              style="background-color: var(--border);">
                            {{ cat }}
                        </span>
                    {% endfor %}
                </div>
            </div>

        </div>
        {% endfor %}

    </div>

    <div class="flex justify-center items-center gap-4 pt-8 text-sm">

        {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}{% if current_category %}&category={{ current_category }}{% endif %}">
                ← Back
            </a>
        {% endif %}

        {% for num in page_obj.paginator.page_range %}
            <a href="?page={{ num }}{% if current_category %}&category={{ current_category }}{% endif %}"
               class="{% if page_obj.number == num %}font-bold text-[var(--accent)]{% endif %}">
                {{ num }}
            </a>
        {% endfor %}

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if current_category %}&category={{ current_category }}{% endif %}">
                Next →
            </a>
        {% endif %}
    </div>

</section>

<div id="videoModal"
     class="fixed inset-0 bg-black/80 hidden items-center justify-center z-50">

    <div class="relative w-full max-w-xl mx-4 bg-[#0f0f0f] rounded-xl p-6 text-white">

        <button
            onclick="closeVideo()"
            class="absolute top-3 right-3 text-2xl">
            ✕
        </button>

        <h2 class="text-lg font-semibold mb-2">
            Video YouTube’da ochiladi
        </h2>

        <p class="text-sm text-gray-400 mb-4">
            To‘liq player, kanal, kommentlar va sifat uchun video YouTube’da ochiladi.
        </p>

        <a id="youtubeLink"
           href="#"
           target="_blank"
           class="block w-full text-center py-3 rounded-lg
                  bg-red-600 hover:bg-red-700 transition font-medium">
            ▶ YouTube’da ko‘rish
        </a>

    </div>
</div>

<script>
function toggleOthers() {
    const el = document.getElementById("otherCategories");
    el.classList.toggle("hidden");
}

function openVideo(videoId) {
    const modal = document.getElementById('videoModal');
    const link = document.getElementById('youtubeLink');

    link.href = `https://www.youtube.com/watch?v=${videoId}`;
    modal.classList.remove('hidden');
    modal.classList.add('flex');
}

function closeVideo() {
    const modal = document.getElementById('videoModal');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
}
</script>

{% endblock %}
